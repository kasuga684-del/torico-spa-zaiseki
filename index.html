<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在籍面接エントリー</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap');
        body { font-family: 'M PLUS Rounded 1c', sans-serif; background-color: #fff0f5; color: #444; }
        .container-box { max-w-md; margin: 0 auto; background-color: #ffffff; padding: 24px; min-height: 100vh; box-shadow: 0 0 15px rgba(236, 72, 153, 0.1); }
        .form-title { text-align: center; font-size: 1.25rem; font-weight: 700; color: #db2777; margin-bottom: 24px; border-bottom: 2px solid #fce7f3; padding-bottom: 12px; }
        .label-text { font-weight: 700; color: #be185d; font-size: 0.95rem; margin-bottom: 6px; display: flex; align-items: center; }
        .label-icon { margin-right: 6px; color: #f472b6; }
        .input-field, .select-field, .textarea-field { width: 100%; padding: 12px; border: 1px solid #fbcfe8; border-radius: 12px; outline: none; transition: 0.2s; background: #fff; font-size: 1rem; }
        .radio-group { display: flex; gap: 15px; margin-top: 5px; background: #fff0f5; padding: 10px; border-radius: 10px; }
        .submit-btn { background: linear-gradient(to right, #ec4899, #db2777); color: white; font-weight: bold; padding: 16px; border-radius: 50px; width: 100%; font-size: 1.1rem; box-shadow: 0 4px 10px rgba(236, 72, 153, 0.3); transition: transform 0.2s; cursor: pointer; }
        .submit-btn:active { transform: scale(0.98); }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container-box">
        <h1 class="form-title"><i class="fas fa-heart text-pink-400 mr-2"></i>在籍面接エントリー</h1>
        <div id="loading" class="text-center py-10"><i class="fas fa-spinner fa-spin text-4xl text-pink-400"></i><p class="text-pink-400 mt-2">読み込み中...</p></div>
        
        <form id="applicationForm" class="space-y-6 hidden">
            <input type="hidden" id="userId" name="userId">
            <!-- ★合言葉：在籍用 -->
            <input type="hidden" name="form_type" value="zaiseki">
            
            <div>
                <label class="label-text"><i class="fas fa-search label-icon"></i>どの求人サイトを見ましたか？</label>
                <select name="site" class="select-field"><option value="">選択してください</option><option>バニラ</option><option>ガールズヘブン</option><option>その他</option></select>
            </div>
            <div>
                <label class="label-text"><i class="fas fa-user label-icon"></i>お名前</label>
                <input name="name" type="text" required class="input-field" placeholder="例：田中ゆり">
            </div>
            <div>
                <label class="label-text"><i class="fas fa-map-marker-alt label-icon"></i>お住まい</label>
                <input name="address" type="text" class="input-field" placeholder="例：高知県高知市">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div><label class="label-text">年齢</label><select id="ageSelect" name="age" class="select-field"><option value="">選択</option></select></div>
                <div><label class="label-text">身長</label><select id="heightSelect" name="height" class="select-field"><option value="">選択</option></select></div>
                <div><label class="label-text">体重</label><select id="weightSelect" name="weight" class="select-field"><option value="">選択</option></select></div>
                <div><label class="label-text">カップ</label><select name="cup" class="select-field"><option value="">選択</option><option>A</option><option>B</option><option>C</option><option>D</option><option>E</option><option>F</option><option>G</option><option>H</option><option>I</option><option>J</option><option>K</option><option>L</option> <option>それ以上</option></select></div>
            </div>
            <div>
                <label class="label-text"><i class="fas fa-spa label-icon"></i>エステ経験</label>
                <div class="radio-group">
                    <label><input type="radio" name="esthe" value="有る"> 有る</label>
                    <label class="ml-4"><input type="radio" name="esthe" value="無し" checked> 無し</label>
                </div>
            </div>
            <div class="bg-pink-50 p-4 rounded-xl border border-pink-100">
                <label class="label-text mb-3"><i class="far fa-calendar-alt label-icon"></i>面接希望日</label>
                <div class="mb-3"><label class="text-sm font-bold text-pink-600 block mb-1">第1希望</label><div class="flex gap-2"><input name="date1" type="date" class="input-field w-3/5"><select name="time1" id="timeSelect1" class="input-field w-2/5"><option value="">時間</option></select></div></div>
                <div><label class="text-sm font-bold text-pink-600 block mb-1">第2希望</label><div class="flex gap-2"><input name="date2" type="date" class="input-field w-3/5"><select name="time2" id="timeSelect2" class="input-field w-2/5"><option value="">時間</option></select></div></div>
            </div>
            <div>
                <label class="label-text"><i class="fas fa-map-pin label-icon"></i>面接場所の希望</label>
                <textarea name="place" rows="3" class="textarea-field" placeholder="車があれば指定の場所までお越し下さい。移動手段が無い場合は近くまでお伺いしますので、希望の場所をご記入ください。"></textarea>
            </div>
            <div>
                <label class="label-text"><i class="far fa-question-circle label-icon"></i>質問</label>
                <textarea name="question" rows="3" class="textarea-field" placeholder="気になることがあればご記入ください"></textarea>
            </div>
            <div class="pt-4 pb-8">
                <button type="button" id="submitBtn" class="submit-btn">送信する <i class="fas fa-paper-plane ml-2"></i></button>
            </div>
        </form>
    </div>

    <script>
        // ==========================================
        // ★設定エリア (Candy Splash在籍用)
        // 在籍用のLIFF ID
        const MY_LIFF_ID = '2008582218-KbYWgaBz'; 
        // GASのURL (出稼ぎ用と同じ分岐対応版URL)
        const GAS_URL    = 'https://script.google.com/macros/s/AKfycbwqPXeNYKrZpz7ChKTote_RBXuCKbpG5_DXzij7j1hWyVvV2p6J_p3H3rrDdcHxG4f6RA/exec';
        // ==========================================

        window.onload = function() {
            const ageSelect=document.getElementById('ageSelect'), hSelect=document.getElementById('heightSelect'), wSelect=document.getElementById('weightSelect');
            for(let i=18;i<=50;i++) ageSelect.add(new Option(i+"歳",i+"歳"));
            for(let h=135;h<=185;h++) hSelect.add(new Option(h,h));
            for(let w=30;w<=100;w++) wSelect.add(new Option(w,w));
            const t1=document.getElementById('timeSelect1'), t2=document.getElementById('timeSelect2');
            for(let h=10;h<=23;h++){
                t1.add(new Option(h+":00",h+":00")); t1.add(new Option(h+":30",h+":30"));
                t2.add(new Option(h+":00",h+":00")); t2.add(new Option(h+":30",h+":30"));
            }
            initializeLiff();
        };

        const form = document.getElementById('applicationForm');
        const submitBtn = document.getElementById('submitBtn');
        const userIdInput = document.getElementById('userId');

        async function initializeLiff() {
            try {
                await liff.init({ liffId: MY_LIFF_ID });
                if (!liff.isLoggedIn()) { liff.login(); return; }
                const profile = await liff.getProfile();
                userIdInput.value = profile.userId;
                document.getElementById('loading').style.display='none';
                form.classList.remove('hidden');
            } catch (err) {
                // プレビューなどでエラーが出てもフォームを表示する（デバッグ用）
                document.getElementById('loading').style.display='none';
                form.classList.remove('hidden');
                // alert('LINE認証エラー: ' + err);
            }
        }

        // ★送信ボタンのクリックイベント（ここが重要！）
        submitBtn.addEventListener('click', function(e) {
            e.preventDefault();
            
            // 名前だけ簡易チェック
            const nameInput = document.querySelector('input[name="name"]');
            if (!nameInput.value) {
                alert('お名前を入力してください');
                return;
            }

            submitBtn.disabled = true; 
            submitBtn.innerHTML = '送信中...';
            
            const formData = new FormData(form);
            
            fetch(GAS_URL, { method: 'POST', mode: 'no-cors', body: formData })
            .then(() => {
                alert('送信完了！');
                liff.closeWindow();
            })
            .catch(() => {
                alert('送信失敗');
                submitBtn.disabled = false;
                submitBtn.innerHTML = '送信する';
            });
        });
    </script>
</body>
</html>
